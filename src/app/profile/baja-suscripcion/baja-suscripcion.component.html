<div class="baja-suscripcion-container">
  @if (validandoPlazo()) {
  <div class="loading-container">
    <p-progressSpinner />
    <p class="text-lg mt-3">Validando plazo de modificación...</p>
  </div>
  } @else if (validacion && validacion.valido) {
  <div class="baja-content">
    <div class="header-section">
      <div class="header-icon">
        <i class="pi pi-exclamation-triangle"></i>
      </div>
      <h1 class="header-title">Lamentamos que hayas decidido darte de baja</h1>
      <p class="header-subtitle">
        Nos gustaría mejorar cada día y tu opinión es muy importante para nosotros
      </p>
      <p class="header-note">
        <i class="pi pi-heart"></i>
        Cuéntanos brevemente el motivo de tu baja o qué podríamos haber hecho mejor
      </p>
      <p class="header-thanks">
        ¡Gracias por tu tiempo y por haber formado parte de la comunidad Técnika Fire!
      </p>
    </div>

    <div class="motivos-section">
      <h3 class="section-title">
        <i class="pi pi-list"></i>
        Motivos de baja
      </h3>
      <p class="section-subtitle">Selecciona uno o varios motivos:</p>

      <div class="motivos-scroll-container">
        <div class="motivos-grid">
          @for (option of motivosOptions; track option.value) {
          <div
            class="motivo-card"
            [class.selected]="isMotivoSelected(option.value)"
            (click)="onMotivoChange(option.value, !isMotivoSelected(option.value))"
          >
            <div class="motivo-checkbox">
              <p-checkbox
                [value]="option.value"
                [binary]="true"
                [ngModel]="isMotivoSelected(option.value)"
                (onChange)="onMotivoChange(option.value, $event.checked)"
                [inputId]="'motivo-' + option.value"
              />
            </div>
            <label [for]="'motivo-' + option.value" class="motivo-label">
              {{ option.label }}
            </label>
            @if (isMotivoSelected(option.value)) {
            <div class="motivo-selected-badge">
              <i class="pi pi-check-circle"></i>
            </div>
            }
          </div>
          }
        </div>
      </div>
    </div>

    <div class="comentario-section">
      <label for="comentario" class="comentario-label">
        <i class="pi pi-comment"></i>
        Comentario adicional (opcional)
      </label>
      <textarea
        pInputTextarea
        id="comentario"
        [(ngModel)]="comentarioAdicional"
        rows="5"
        class="w-full"
        placeholder="Cuéntanos más sobre tu decisión..."
        [maxLength]="1000"
      ></textarea>
      <small class="comentario-counter">{{ comentarioAdicional.length }}/1000</small>
    </div>

    <div class="important-note">
      <i class="pi pi-info-circle"></i>
      <div class="note-content">
        <strong>Importante:</strong> Si eres usuario de WordPress y prefieres gestionar tu baja directamente desde allí,
        puedes hacerlo accediendo a <a [href]="wordpressUrl + '/mi-cuenta'" target="_blank">Mi Cuenta → Suscripciones</a>.
        Recuerda que solo puedes dar de baja hasta 5 días antes de tu próxima renovación.
      </div>
    </div>

    <div class="footer-actions">
      <p-button
        label="Cancelar"
        icon="pi pi-times"
        (onClick)="cancelar()"
        [outlined]="true"
        severity="secondary"
        styleClass="cancel-button"
      />
      <p-button
        label="Continuar con la baja"
        icon="pi pi-sign-out"
        (onClick)="abrirDialogConfirmacion()"
        severity="danger"
        [disabled]="motivosSeleccionados.length === 0"
        styleClass="confirm-button"
      />
    </div>
  </div>
  }
</div>
