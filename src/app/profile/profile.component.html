<div class="profile-container">
  <!-- Spinner de carga -->
  <div class="loading-container" *ngIf="isLoading$ | async">
    <ngx-spinner type="ball-scale-multiple"></ngx-spinner>
    <p>Cargando perfil...</p>
  </div>

  <div class="profile-content" *ngIf="!(isLoading$ | async) && user">
    <div class="grid">
      <!-- Información del perfil (lado izquierdo) -->
      <div
        class="col-12"
        [ngClass]="{
          'md:col-8': user.rol !== 'ADMIN',
          'md:col-12': user.rol === 'ADMIN'
        }"
      >
        <div class="profile-card">
          <div class="card-header">
            <h2><i class="pi pi-user-edit"></i> Mi Perfil</h2>
          </div>

          <div class="card-content">
            <div class="user-info-header mb-4">
              <div class="avatar-container">
                <app-avatar-upload
                  [avatarUrl]="user.avatarUrl"
                ></app-avatar-upload>
              </div>
              <div class="user-info-text">
                <h3>{{ user.nombre }} {{ user.apellidos }}</h3>
                <span
                  class="user-role"
                  [ngClass]="{ 'admin-role': user.rol === 'ADMIN' }"
                >
                  {{ user.rol === "ADMIN" ? "Administrador" : "Alumno" }}
                </span>
                <div class="user-community">
                  <app-comunidad-picker
                    [comunidades]="[user.comunidad]"
                  ></app-comunidad-picker>
                </div>
              </div>
            </div>

            <!-- Campos de formulario -->
            <div class="form-group mb-3">
              <label for="nombre">Nombre</label>
              <input
                type="text"
                pInputText
                id="nombre"
                [(ngModel)]="user.nombre"
                class="w-full"
              />
            </div>

            <div class="form-group mb-3">
              <label for="apellidos">Apellidos</label>
              <input
                type="text"
                pInputText
                id="apellidos"
                [(ngModel)]="user.apellidos"
                class="w-full"
              />
            </div>

            <div class="form-group mb-3">
              <label for="dni">DNI/NIE</label>
              <input
                type="text"
                pInputText
                id="dni"
                [(ngModel)]="user.dni"
                placeholder="Ej: 12345678Z"
                class="w-full"
              />
            </div>

            <div class="form-group mb-3">
              <label for="email">Email</label>
              <input
                type="text"
                pInputText
                id="email"
                [value]="user.email"
                disabled
                class="w-full"
              />
            </div>

            <div class="form-group mb-3">
              <label for="comunidad">Comunidad</label>
              <app-comunidad-dropdown
                [(ngModel)]="user.comunidad"
              ></app-comunidad-dropdown>
            </div>

            <div class="form-group mb-3">
              <label for="tutores">Tutor asignado</label>
              <p-dropdown
                id="tutores"
                styleClass="w-full"
                [options]="(tutores$ | async) ?? []"
                [(ngModel)]="user.tutorId"
                optionLabel="email"
                optionValue="id"
                appendTo="body"
                placeholder="Tutor (opcional)"
              >
                <ng-template let-item pTemplate="selectedItem">
                  <div class="flex align-items-center gap-2">
                    <div>
                      {{
                        item.nombre && item.apellidos
                          ? item.nombre + " " + item.apellidos
                          : item.email
                      }}
                    </div>
                  </div>
                </ng-template>
                <ng-template let-item let-index pTemplate="item">
                  <div class="flex align-items-center gap-2">
                    <div>
                      {{
                        item.nombre && item.apellidos
                          ? item.nombre + " " + item.apellidos
                          : item.email
                      }}
                    </div>
                  </div>
                </ng-template>
              </p-dropdown>
            </div>

            <div class="form-group mb-3">
              <app-metodo-calificacion-picker
                [(value)]="user.metodoCalificacion"
                [showClear]="false"
                label="Método de calificación"
                placeholder="Seleccione un método de calificación"
              ></app-metodo-calificacion-picker>

              <div class="form-group mb-3" *ngIf="user.rol === 'ADMIN'">
                <label for="esTutor">Este usuario es tutor?</label>
                <p-toggleButton
                  id="esTutor"
                  [(ngModel)]="user.esTutor"
                  onLabel="Sí"
                  offLabel="No"
                  styleClass="w-full"
                ></p-toggleButton>
              </div>

              <div
                class="planification-section mt-4"
                *ngIf="user.rol === 'ALUMNO'"
              >
                <div
                  class="assigned-planifications flex justify-content-between align-items-center"
                >
                  <ng-container
                    *ngIf="
                      countPlanificacionesAsignadas$ | async as count;
                      else noPlanificaciones
                    "
                  >
                    <label>Planificaciones asignadas:</label>
                    <span class="planification-count">{{ count }}</span>
                  </ng-container>

                  <ng-template #noPlanificaciones>
                    <div class="no-planification-message">
                      <p>No tienes planificaciones asignadas</p>
                      <p-button
                        styleClass="p-button-outlined"
                        icon="pi pi-sync"
                        label="Asignar planificación automáticamente"
                        (click)="autoAssignPlanificacion()"
                      ></p-button>
                    </div>
                  </ng-template>
                </div>
              </div>

              <!-- Botones de acción -->
              <div class="action-buttons mt-4 flex justify-content-end">
                <app-async-button
                  label="Guardar cambios"
                  icon="pi pi-save"
                  [action]="saveProfile.bind(this)"
                ></app-async-button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Información de suscripción (lado derecho) -->
      <div class="col-12 md:col-4" *ngIf="user.rol !== 'ADMIN'">
        <div class="subscription-card">
          <div class="card-header">
            <h2><i class="pi pi-credit-card"></i> Mi Suscripción</h2>
          </div>

          <div class="card-content">
            <!-- Si no hay suscripción -->
            <div class="no-subscription" *ngIf="!user.suscripcion">
              <i class="pi pi-info-circle"></i>
              <h3>Sin suscripción activa</h3>
              <p>No tienes ninguna suscripción activa en este momento.</p>
              <a href="https://tecnikafire.com/tarifas/" target="_blank">
                <p-button
                  label="Obtener plan"
                  icon="pi pi-external-link"
                  styleClass="p-button-outlined mt-3"
                ></p-button>
              </a>
            </div>

            <!-- Si hay suscripción -->
            <div class="subscription-details" *ngIf="user.suscripcion">
              <div
                class="plan-type-badge"
                [ngClass]="'plan-type-' + user.suscripcion.tipo.toLowerCase()"
              >
                {{
                  user.suscripcion.tipo === SuscripcionTipo.BASIC
                    ? "Básico"
                    : user.suscripcion.tipo === SuscripcionTipo.ADVANCED
                    ? "Avanzado"
                    : user.suscripcion.tipo === SuscripcionTipo.PREMIUM
                    ? "Premium"
                    : user.suscripcion.tipo
                }}
              </div>

              <div class="subscription-info">
                <div class="subscription-item">
                  <label class="mb-0">Estado:</label>
                  <span [ngClass]="getSubscriptionStatusClass()">
                    {{ user.suscripcion.status || "Activo" }}
                  </span>
                </div>

                <div class="subscription-item">
                  <label class="mb-0">Precio mensual:</label>
                  <span>{{ user.suscripcion.monthlyPrice || 0 }} €</span>
                </div>

                <div class="subscription-item">
                  <label class="mb-0">Fecha de inicio:</label>
                  <span>{{
                    user.suscripcion.fechaInicio | date : "dd/MM/yyyy"
                  }}</span>
                </div>

                <!-- <div class="subscription-item">
                  <label>Fecha de fin:</label>
                  <span>{{ getSubscriptionEndDate() }}</span>
                </div> -->
              </div>

              <div
                class="subscription-countdown"
                *ngIf="getRemainingDays() > 0"
              >
                <div class="countdown-title">Tu suscripción finaliza en:</div>
                <div
                  class="countdown-days"
                  [ngClass]="getSubscriptionStatusClass()"
                >
                  {{ getRemainingDays() }} días
                </div>
              </div>

              <div class="subscription-actions mt-4">
                <!-- Banner de vinculación si no está vinculado -->
                <div
                  class="link-banner mb-3 p-3 border-round"
                  *ngIf="!isLinkedToWordPress()"
                >
                  <div class="flex align-items-start gap-3">
                    <i class="pi pi-info-circle text-2xl"></i>
                    <div class="flex-1">
                      <h4 class="m-0 mb-2">Vincula tu cuenta con WordPress</h4>
                      <p class="m-0 mb-2 text-sm">
                        Para gestionar tu suscripción y pagos, vincula tu cuenta
                        con WordPress.
                      </p>
                      <p
                        class="m-0 mb-3 text-sm font-semibold"
                        style="color: #ffd700"
                        *ngIf="user?.suscripcion"
                      >
                        ⚠️ Atención: Tu suscripción actual será cancelada al
                        vincular.
                      </p>
                      <p class="m-0 mb-3 text-sm" *ngIf="!user?.suscripcion">
                        Después podrás seleccionar el plan que mejor se adapte a
                        ti.
                      </p>
                      <p-button
                        label="Vincular ahora"
                        icon="pi pi-link"
                        styleClass="p-button-sm"
                        (onClick)="handleSubscriptionAction()"
                      ></p-button>
                    </div>
                  </div>
                </div>

                <!-- Banner sin plan activo -->
                <div
                  class="no-plan-banner mb-3 p-3 border-round"
                  *ngIf="isLinkedToWordPress() && !hasActiveWooCommerceSubscription()"
                >
                  <div class="flex align-items-start gap-3">
                    <i class="pi pi-exclamation-triangle text-2xl"></i>
                    <div class="flex-1">
                      <h4 class="m-0 mb-2">No tienes un plan activo</h4>
                      <p class="m-0 mb-3 text-sm">
                        Para acceder a todo el contenido, necesitas contratar un
                        plan.
                      </p>
                      <p-button
                        [label]="getSubscriptionButtonLabel()"
                        [icon]="getSubscriptionButtonIcon()"
                        styleClass="p-button-sm"
                        (onClick)="handleSubscriptionAction()"
                      ></p-button>
                    </div>
                  </div>
                </div>

                <!-- Botones de gestión cuando tiene plan activo -->
                <div
                  class="flex flex-column gap-2"
                  *ngIf="isLinkedToWordPress() && hasActiveWooCommerceSubscription()"
                >
                  <p-button
                    label="Cambiar plan"
                    icon="pi pi-sync"
                    styleClass="p-button-outlined w-full"
                    (onClick)="navegarACambioSuscripcion()"
                  ></p-button>
                  <p-button
                    label="Dar de baja"
                    icon="pi pi-sign-out"
                    styleClass="p-button-outlined p-button-danger w-full"
                    (onClick)="navegarABajaSuscripcion()"
                  ></p-button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Card de Información Personal / Onboarding -->
        <div class="onboarding-card mt-4" *ngIf="user.rol === Rol.ALUMNO">
          <div class="card-header">
            <h2><i class="pi pi-user-plus"></i> Información Personal</h2>
          </div>

          <div class="card-content">
            <div class="onboarding-status mb-3">
              <div class="completion-info">
                <div
                  class="flex justify-content-between align-items-center mb-2"
                >
                  <span class="completion-text"> Información completada: </span>
                  <span class="completion-percentage font-semibold">
                    {{ getOnboardingCompletionPercentage() }}%
                  </span>
                </div>
                <div class="completion-bar">
                  <div
                    class="completion-fill"
                    [style.width.%]="getOnboardingCompletionPercentage()"
                    [ngClass]="{
                      low: getOnboardingCompletionPercentage() < 30,
                      medium:
                        getOnboardingCompletionPercentage() >= 30 &&
                        getOnboardingCompletionPercentage() < 70,
                      high:
                        getOnboardingCompletionPercentage() >= 70 &&
                        getOnboardingCompletionPercentage() < 80,
                      complete: getOnboardingCompletionPercentage() >= 80
                    }"
                  ></div>
                </div>
              </div>
            </div>

            <div
              class="onboarding-help"
              *ngIf="getOnboardingCompletionPercentage() < 100"
            >
              <div class="help-message">
                <i class="pi pi-info-circle mr-2"></i>
                <span>
                  Completar esta información nos ayuda a personalizar tu
                  experiencia de aprendizaje
                </span>
              </div>
            </div>

            <div class="completed-message" *ngIf="isOnboardingComplete()">
              <i class="pi pi-check-circle mr-2"></i>
              <span *ngIf="getOnboardingCompletionPercentage() >= 100">
                ¡Información completa! Gracias por ayudarnos a conocerte mejor.
              </span>
              <span
                *ngIf="
                  getOnboardingCompletionPercentage() >= 80 &&
                  getOnboardingCompletionPercentage() < 100
                "
              >
                ¡Lo tienes bastante bien! Aunque todavía puedes mejorar tu
                perfil completando el
                {{ 100 - getOnboardingCompletionPercentage() }}% restante.
              </span>
            </div>

            <div class="onboarding-actions mt-4">
              <p-button
                label="Completar información"
                icon="pi pi-pencil"
                styleClass="p-button-outlined w-full"
                (click)="openOnboardingModal()"
              ></p-button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Mostrar errores -->
    <div class="error-container" *ngIf="errors.length > 0">
      <div class="error-card">
        <div class="error-list">
          <h3>Errores:</h3>
          <ul>
            <li *ngFor="let error of errors">{{ error }}</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de onboarding -->
<p-dialog
  header="Completar ficha personal"
  [(visible)]="showOnboardingModal"
  [modal]="true"
  [style]="{ width: '90vw', maxWidth: '1000px' }"
  [draggable]="false"
  [resizable]="false"
  [maximizable]="true"
>
  <p *ngIf="firstTimeShowingOnboardingModal" class="text-center">
    La información que recopilamos nos permite ofrecerte un servicio más
    personalizado y eficiente.
  </p>
  <app-onboarding-form
    #onboardingForm
    [initialData]="onboardingData"
    [isOptional]="true"
    [showTitle]="false"
    [showSkipButton]="false"
    (dataSubmitted)="onOnboardingUpdated($event)"
  ></app-onboarding-form>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-end align-items-center">
      <div class="completion-hint" *ngIf="viewportService.isMobile()">
        <small class="text-500">
          <i class="pi pi-info-circle mr-1"></i>
          Esta información nos ayuda a personalizar tu experiencia de
          aprendizaje
        </small>
      </div>

      <div class="flex gap-2 justify-content-end">
        <p-button
          type="submit"
          [label]="
            isFormPartiallyFilled()
              ? 'Actualizar información'
              : 'Guardar información'
          "
          styleClass="p-button-raised"
          [disabled]="!onboardingForm?.formGroup?.valid"
          (click)="onboardingForm?.onSubmit()"
        />
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- Dialog para Cambio de Suscripción -->
<p-dialog
  header="Cambio de Suscripción"
  [(visible)]="showCambioSuscripcionDialog"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '95vw', maxWidth: '1400px' }"
  (onHide)="cerrarDialogCambioSuscripcion()"
>
  <app-cambio-suscripcion
    *ngIf="showCambioSuscripcionDialog"
    (cerrar)="cerrarDialogCambioSuscripcion()"
    (solicitarConfirmacion)="onSolicitarConfirmacionCambio($event)"
    (mostrarFueraDePlazo)="onFueraDePlazoCambio($event)"
  ></app-cambio-suscripcion>
</p-dialog>

<!-- Dialog para Baja de Suscripción -->
<p-dialog
  header="Baja de Suscripción"
  [(visible)]="showBajaSuscripcionDialog"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '95vw', maxWidth: '1200px' }"
  (onHide)="cerrarDialogBajaSuscripcion()"
>
  <app-baja-suscripcion
    *ngIf="showBajaSuscripcionDialog"
    (cerrar)="cerrarDialogBajaSuscripcion()"
    (solicitarConfirmacion)="onSolicitarConfirmacionBaja($event)"
    (mostrarFueraDePlazo)="onFueraDePlazoBaja($event)"
  ></app-baja-suscripcion>
</p-dialog>

<!-- Dialog de Confirmación Cambio -->
<p-dialog
  header="Confirmar Cambio de Suscripción"
  [(visible)]="showConfirmacionCambio"
  [modal]="true"
  [style]="{ width: '550px' }"
  [draggable]="false"
  [resizable]="false"
  [closable]="!procesandoCambio"
>
  @if (procesandoCambio) {
  <div class="flex flex-column align-items-center justify-content-center gap-3" style="min-height: 200px;">
    <p-progressSpinner />
    <p class="text-lg font-medium">Procesando cambio de suscripción...</p>
    <p class="text-sm text-600">Por favor, espera un momento</p>
  </div>
  } @else {
  <div class="flex flex-column gap-3">
    <p class="text-lg">
      <i class="pi pi-info-circle text-blue-500 mr-2"></i>
      ¿Confirmas el cambio a este plan?
    </p>

    @if (datosConfirmacionCambio?.planSeleccionado) {
    <div class="p-3 surface-100 border-round">
      <div class="flex justify-content-between align-items-center mb-2">
        <span class="font-medium">Nuevo plan:</span>
        <span class="text-xl font-bold text-primary">{{
          datosConfirmacionCambio.planSeleccionado.name
        }}</span>
      </div>
      <div class="flex justify-content-between align-items-center">
        <span class="font-medium">Precio mensual:</span>
        <span class="text-xl font-bold">{{
          datosConfirmacionCambio.planSeleccionado.price
        }}€</span>
      </div>
    </div>
    }

    <div class="p-3 surface-50 border-round border-1 border-primary">
      <p class="font-medium mb-2">
        <i class="pi pi-calendar mr-2"></i>
        Fecha de aplicación del cambio:
      </p>
      <p class="text-lg font-bold text-primary">
        {{ datosConfirmacionCambio?.validacion?.proximoPago | date : 'dd/MM/yyyy' }}
      </p>
    </div>

    <p class="text-sm text-600 line-height-3">
      El cambio se hará efectivo en tu próxima fecha de facturación. Tu plan
      actual permanecerá activo hasta entonces.
    </p>

    @if (datosConfirmacionCambio?.comentario) {
    <div class="mt-2">
      <p class="font-medium text-sm mb-1">Tu comentario:</p>
      <p class="text-sm text-600 p-2 surface-100 border-round">
        {{ datosConfirmacionCambio.comentario }}
      </p>
    </div>
    }
  </div>
  }

  <ng-template pTemplate="footer">
    @if (!procesandoCambio) {
    <div class="flex justify-content-end gap-2">
      <p-button
        label="Volver"
        icon="pi pi-arrow-left"
        (onClick)="showConfirmacionCambio = false"
        [text]="true"
        styleClass="p-button-text"
      />
      <p-button
        label="Confirmar Cambio"
        icon="pi pi-check"
        (onClick)="confirmarCambioDesdePadre()"
      />
    </div>
    }
  </ng-template>
</p-dialog>

<!-- Dialog de Confirmación Baja -->
<p-dialog
  header="Confirmar Baja de Suscripción"
  [(visible)]="showConfirmacionBaja"
  [modal]="true"
  [style]="{ width: '550px' }"
  [draggable]="false"
  [resizable]="false"
  [closable]="!procesandoBaja"
>
  @if (procesandoBaja) {
  <div class="flex flex-column align-items-center justify-content-center gap-3" style="min-height: 200px;">
    <p-progressSpinner />
    <p class="text-lg font-medium">Procesando baja de suscripción...</p>
    <p class="text-sm text-600">Por favor, espera un momento</p>
  </div>
  } @else {
  <div class="flex flex-column gap-3">
    <p class="text-lg">
      <i class="pi pi-exclamation-triangle text-orange-500 mr-2"></i>
      ¿Estás seguro de que deseas dar de baja tu suscripción?
    </p>

    <div class="p-3 surface-100 border-round">
      <p class="font-medium mb-2">Tu suscripción permanecerá activa hasta:</p>
      <p class="text-xl font-bold text-primary">
        {{ datosConfirmacionBaja?.validacion?.proximoPago | date : 'dd/MM/yyyy' }}
      </p>
    </div>

    <p class="text-sm text-600">
      Una vez confirmada, tu suscripción se cancelará y no se renovará
      automáticamente. Podrás seguir disfrutando del servicio hasta la fecha
      indicada.
    </p>

    @if (datosConfirmacionBaja?.motivos && datosConfirmacionBaja.motivos.length > 0) {
    <div class="mt-2">
      <p class="font-medium text-sm mb-1">Motivos seleccionados:</p>
      <div class="flex flex-wrap gap-2">
        @for (motivo of datosConfirmacionBaja.motivos; track motivo) {
        <span class="p-2 surface-100 border-round text-sm">
          {{ getMotivoLabel(motivo) }}
        </span>
        }
      </div>
    </div>
    }

    @if (datosConfirmacionBaja?.comentario) {
    <div class="mt-2">
      <p class="font-medium text-sm mb-1">Tu comentario:</p>
      <p class="text-sm text-600 p-2 surface-100 border-round">
        {{ datosConfirmacionBaja.comentario }}
      </p>
    </div>
    }
  </div>
  }

  <ng-template pTemplate="footer">
    @if (!procesandoBaja) {
    <div class="flex justify-content-end gap-2">
      <p-button
        label="Volver"
        icon="pi pi-arrow-left"
        (onClick)="showConfirmacionBaja = false"
        [text]="true"
        styleClass="p-button-text"
      />
      <p-button
        label="Confirmar Baja"
        icon="pi pi-check"
        (onClick)="confirmarBajaDesdePadre()"
        severity="danger"
      />
    </div>
    }
  </ng-template>
</p-dialog>

<!-- Dialog Fuera de Plazo Cambio -->
<p-dialog
  header="Solicitud fuera de plazo"
  [(visible)]="showFueraDePlazoCambio"
  [modal]="true"
  [style]="{ width: '550px' }"
  [draggable]="false"
  [resizable]="false"
  [closable]="false"
>
  <div class="flex flex-column gap-3">
    <div class="flex align-items-center gap-2 mb-2">
      <i class="pi pi-info-circle text-orange-500 text-3xl"></i>
      <h3 class="m-0">No se puede procesar la solicitud</h3>
    </div>

    <p class="text-700 line-height-3">
      Te informamos de que la solicitud de modificación de tu suscripción no se
      ha podido tramitar, ya que debe realizarse con al menos
      <strong>10 días de antelación</strong> a la fecha del próximo cobro.
    </p>

    <div class="p-3 surface-100 border-round">
      <div class="flex justify-content-between mb-2">
        <span class="font-medium">Próximo cobro:</span>
        <span class="font-bold">{{
          validacionPlazo?.proximoPago | date : 'dd/MM/yyyy'
        }}</span>
      </div>
      <div class="flex justify-content-between">
        <span class="font-medium">Días restantes:</span>
        <span
          class="font-bold"
          [class.text-red-500]="validacionPlazo && validacionPlazo.diasRestantes < 10"
        >
          {{ validacionPlazo?.diasRestantes }} días
        </span>
      </div>
    </div>

    <p class="text-sm text-600 line-height-3">
      En este caso, el pago ya programado se efectuará con normalidad, y tu
      solicitud quedará registrada para aplicarse al periodo siguiente.
    </p>

    <p class="text-sm text-600">
      Agradecemos tu comprensión y te recordamos que puedes contactar con
      nuestro equipo si necesitas más información o asistencia con tu
      suscripción.
    </p>

    <p class="font-medium text-center mt-2">
      Gracias por formar parte de TecnikaFire.
    </p>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center">
      <p-button
        label="Entendido"
        icon="pi pi-check"
        (onClick)="cerrarFueraDePlazoCambio()"
      />
    </div>
  </ng-template>
</p-dialog>

<!-- Dialog Fuera de Plazo Baja -->
<p-dialog
  header="Solicitud fuera de plazo"
  [(visible)]="showFueraDePlazoBaja"
  [modal]="true"
  [style]="{ width: '550px' }"
  [draggable]="false"
  [resizable]="false"
  [closable]="false"
>
  <div class="flex flex-column gap-3">
    <div class="flex align-items-center gap-2 mb-2">
      <i class="pi pi-info-circle text-orange-500 text-3xl"></i>
      <h3 class="m-0">No se puede procesar la solicitud</h3>
    </div>

    <p class="text-700 line-height-3">
      Te informamos de que la solicitud de baja de tu suscripción no se ha
      podido tramitar, ya que debe realizarse con al menos
      <strong>10 días de antelación</strong> a la fecha del próximo cobro.
    </p>

    <div class="p-3 surface-100 border-round">
      <div class="flex justify-content-between mb-2">
        <span class="font-medium">Próximo cobro:</span>
        <span class="font-bold">{{
          validacionPlazo?.proximoPago | date : 'dd/MM/yyyy'
        }}</span>
      </div>
      <div class="flex justify-content-between">
        <span class="font-medium">Días restantes:</span>
        <span
          class="font-bold"
          [class.text-red-500]="validacionPlazo && validacionPlazo.diasRestantes < 10"
        >
          {{ validacionPlazo?.diasRestantes }} días
        </span>
      </div>
    </div>

    <p class="text-sm text-600 line-height-3">
      En este caso, el pago ya programado se efectuará con normalidad, y tu
      solicitud quedará registrada para aplicarse al periodo siguiente.
    </p>

    <p class="text-sm text-600">
      Agradecemos tu comprensión y te recordamos que puedes contactar con
      nuestro equipo si necesitas más información o asistencia con tu
      suscripción.
    </p>

    <p class="font-medium text-center mt-2">
      Gracias por formar parte de TecnikaFire.
    </p>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center">
      <p-button
        label="Entendido"
        icon="pi pi-check"
        (onClick)="cerrarFueraDePlazoBaja()"
      />
    </div>
  </ng-template>
</p-dialog>
