<p-confirmDialog></p-confirmDialog>

<app-generic-list
  [fetchItems$]="fetchItems$"
  [itemTemplate]="flashcardItemTemplate"
  [filters]="filters"
  (onItemClick)="navigateToDetailview($any($event).id)"
  (filtersChanged)="onFiltersChanged($event)"
>
  <div left-actions>
      <p-iconField iconPosition="left">
        <p-inputIcon styleClass="pi pi-search"></p-inputIcon>
        <input
          type="text"
          pInputText
        placeholder="Buscar flashcards"
          style="min-width: 30vw"
          [value]="pagination().searchTerm"
          (input)="valueChanged($event)"
        />
      </p-iconField>
  </div>

  <div right-actions>
    <div class="flex gap-2">
        <p-button
          *ngIf="expectedRole == 'ADMIN'"
          label="{{
            viewportService.screenWidth == 'xs'
              ? undefined
              : 'Descargar flashcards de alumnos'
          }}"
          icon="pi pi-download"
          [link]="true"
          (click)="descargarFlashcardsDeAlumnos()"
        ></p-button>
        <p-button
          label="{{
            viewportService.screenWidth == 'xs' ? undefined : 'Crear nueva'
          }}"
          icon="pi pi-plus"
          [link]="true"
          (click)="navigateToDetailview('new')"
        ></p-button>
        <p-button
          label="{{
            viewportService.screenWidth == 'xs' ? undefined : 'Importar'
          }}"
          icon="pi pi-upload"
          (click)="fileInput.click()"
          [loading]="uploadingFile"
        ></p-button>
        <input
          type="file"
          accept=".xlsx, .xls"
          #fileInput
          style="display: none"
          (change)="onFileSelected($event)"
        />
      </div>
    </div>

  <div empty-template>
    <div class="text-center p-4">No hay flashcards disponibles</div>
  </div>
</app-generic-list>

<!-- Template para el item de flashcard -->
<ng-template #flashcardItemTemplate let-item>
            <div class="flex flex-row align-items-between">
    <div class="flex flex-column py-2 col-9 left-side truncate-flex-content">
                <div class="text-lg font-medium flex gap-2 align-items-center">
                  <div class="flex gap-1">
          <strong
            class="identifier"
            pTooltip="{{ item.identificador }}"
            tooltipPosition="top"
            >{{ item.identificador }}</strong
          >
                  </div>
                  <div class="flex gap-1 align-items-center">
                    <ng-container *ngIf="expectedRole == 'ADMIN'">
                      <i
                        class="pi pi-{{ star }}"
              *ngFor="let star of getStarsBasedOnDifficulty(item.dificultad)"
              pTooltip="Dificultad: {{ item.dificultad }}"
              tooltipPosition="top"
                      ></i>
                    </ng-container>
                  </div>
                  <div class="flex gap-1">
          <span
            class="badge bg-primary text-white"
            pTooltip="Tema: {{ item.tema.numero }}"
            tooltipPosition="top"
          >
            Tema {{ item.tema.numero }}
          </span>
                  </div>
                </div>
      <span
        class="descripcion"
        pTooltip="{{ item.descripcion }}"
        tooltipPosition="top"
        >{{
          item.descripcion && item.descripcion.length > 0
            ? item.descripcion
            : "Sin descripción"
        }}</span
      >
              </div>
    <div class="right-side col-3 flex align-items-center justify-content-end">
      <div class="flex flex-row align-items-center justify-content-end gap-2">
                  <app-comunidad-picker
                    [comunidades]="item.relevancia"
                  ></app-comunidad-picker>
                  <span
          class="text-xs hidden md:block unbreakable-text"
          pTooltip="Fecha de creación: {{
            item.createdAt | date : 'dd/MM/yyyy HH:mm'
          }}"
          tooltipPosition="top"
                  >
                    {{ item.createdAt | date : "short" }}</span
                  >
                  <p-button
                    (click)="
                      $event.stopPropagation();
                      $event.preventDefault();
                      eliminarFlashcard(item.id, $event)
                    "
          icon="pi pi-trash"
          pTooltip="Eliminar flashcard"
          styleClass="p-button-danger"
        ></p-button>
        <p-button
          (click)="
            $event.stopPropagation();
            $event.preventDefault();
            navigateToDetailview(item.id)
          "
          icon="pi pi-pencil"
          pTooltip="Editar flashcard"
                  ></p-button>
            </div>
          </div>
        </div>
      </ng-template>
