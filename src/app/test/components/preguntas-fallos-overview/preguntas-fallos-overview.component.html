<p-confirmDialog></p-confirmDialog>

<app-generic-list
  [fetchItems$]="fetchItems$"
  [itemTemplate]="falloItemTemplate"
  [filters]="filters"
  (onItemClick)="onItemClick($event)"
  (filtersChanged)="onFiltersChanged($event)"
>
  <div left-actions *ngIf="mode == 'overview'">
    <p-iconField iconPosition="left">
      <p-inputIcon styleClass="pi pi-search"></p-inputIcon>
      <input
        type="text"
        pInputText
        placeholder="Buscar por identificador"
        [value]="pagination().searchTerm"
        (input)="valueChanged($event)"
        class="w-full"
      />
    </p-iconField>
  </div>

  <div empty-template>
    <div class="text-center p-4">
      No hay fallos reportados disponibles
    </div>
  </div>
</app-generic-list>

<!-- Template para el item de fallo -->
<ng-template #falloItemTemplate let-item>
  <div class="flex flex-row align-items-between">
    <div class="flex flex-column py-2 col-9 left-side truncate-flex-content">
      <div class="text-lg font-medium flex gap-2 align-items-center">
        <span 
          class="identifier" 
          pTooltip="Identificador de la pregunta" 
          tooltipPosition="top"
        >
          {{ item.pregunta.identificador }}
        </span>
        <span 
          class="badge bg-primary text-white" 
          pTooltip="Número del tema" 
          tooltipPosition="top"
        >
          {{ item.pregunta.tema.numero }}
        </span>
        <span 
          class="badge bg-orange-500 text-white" 
          pTooltip="Usuario que reportó" 
          tooltipPosition="top"
        >
          {{ item.usuario?.nombre || 'Usuario' }}
        </span>
      </div>
      <span 
        class="descripcion" 
        pTooltip="{{ item.descripcion }}" 
        tooltipPosition="top"
      >
        {{ item.descripcion }}
      </span>
    </div>
    <div class="right-side col-3 flex align-items-center justify-content-end">
      <div class="flex flex-row align-items-center justify-content-end gap-2">
        <span 
          class="text-xs hidden md:block unbreakable-text" 
          pTooltip="Fecha del reporte: {{ item.createdAt | date : 'dd/MM/yyyy HH:mm' }}" 
          tooltipPosition="top"
        >
          {{ item.createdAt | date : "short" }}
        </span>
        <p-button
          *ngIf="mode == 'overview'"
          icon="pi pi-eye"
          styleClass="p-button-primary"
          pTooltip="Ver pregunta"
          [routerLink]="['/app/test/preguntas/' + item.pregunta.id]"
          [queryParams]="{ goBack: true }"
          (click)="$event.stopPropagation(); $event.preventDefault()"
        ></p-button>
        <p-button
          *ngIf="mode == 'overview'"
          icon="pi pi-trash"
          styleClass="p-button-danger"
          pTooltip="Eliminar reporte"
          (click)="
            $event.stopPropagation();
            $event.preventDefault();
            eliminarFeedback(item.id, $event)
          "
        ></p-button>
      </div>
    </div>
  </div>

  <!-- Contenido expandido -->
  <div class="expanded-content mt-2" *ngIf="expandedItem === item">
    <div class="p-3 bg-gray-50 rounded">
      <p class="font-medium text-secondary text-sm mb-2">
        <strong>Descripción completa:</strong> {{ item.descripcion }}
      </p>
      <div class="text-sm">
        <strong>Reportado por:</strong>
        <span class="ml-1">
          {{ item.usuario?.nombre }} {{ item.usuario?.apellidos }} ({{ item.usuario?.email }})
        </span>
      </div>
    </div>
  </div>
</ng-template>
