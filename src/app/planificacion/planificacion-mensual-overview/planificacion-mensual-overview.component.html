<p-confirmDialog></p-confirmDialog>

<app-generic-list
  [fetchItems$]="fetchItems$"
  [itemTemplate]="planificacionItemTemplate"
  [filters]="filters"
  (onItemClick)="navigateToDetailview($any($event).id)"
  (filtersChanged)="onFiltersChanged($event)"
>
  <div left-actions>
    <p-iconField iconPosition="left">
      <p-inputIcon styleClass="pi pi-search"></p-inputIcon>
      <input
        type="text"
        pInputText
        class="w-full"
        placeholder="Buscar planificación"
        [value]="pagination().searchTerm"
        (input)="valueChanged($event)"
      />
    </p-iconField>
  </div>

  <div right-actions>
    <div class="flex gap-2">
      <p-button
        icon="pi pi-sync"
        [link]="true"
        (click)="refresh()"
        label="{{ viewportService.screenWidth == 'xs' ? '' : 'Refrescar' }}"
        pTooltip="Refrescar"
      ></p-button>
      <p-button
        *ngIf="expectedRole == 'ADMIN'"
        label="{{
          viewportService.screenWidth == 'xs' ? undefined : 'Crear nueva'
        }}"
        icon="pi pi-plus"
        [link]="true"
        (click)="navigateToDetailview('new')"
      ></p-button>
    </div>
  </div>

  <div empty-template>
    <div class="text-center p-4">
      No hay planificaciones mensuales disponibles
    </div>
  </div>
</app-generic-list>

<!-- Template para el item de planificación -->
<ng-template #planificacionItemTemplate let-item>
  <div class="flex flex-row align-items-between">
    <div class="flex flex-column py-2 col-9 left-side truncate-flex-content">
      <div class="text-lg font-medium flex gap-2 align-items-center">
        <div class="flex gap-1">
          <strong
            class="identifier"
            pTooltip="{{ item.identificador }}"
            tooltipPosition="top"
            >{{ item.identificador }}</strong
          >
        </div>
        <div class="flex gap-1">
          <p-chip
            *ngIf="item.esPorDefecto"
            label="Por defecto"
            pTooltip="Planificación por defecto"
            tooltipPosition="top"
          />
          <p-chip
            label="{{ matchKeyWithLabel(item.tipoDePlanificacion) }}"
            pTooltip="Tipo de planificación: {{
              matchKeyWithLabel(item.tipoDePlanificacion)
            }}"
            tooltipPosition="top"
          />
          <p-chip
            *ngIf="item?.asignacion?.alumno"
            label="{{
              item.asignacion.alumno.nombre
                ? item.asignacion.alumno.nombre +
                  ' ' +
                  item.asignacion.alumno.apellidos
                : item.asignacion.alumno.email
            }}"
            pTooltip="Alumno asignado"
            tooltipPosition="top"
          />
        </div>
      </div>
      <span
        class="descripcion"
        pTooltip="{{ item.descripcion }}"
        tooltipPosition="top"
        >{{
          item.descripcion && item.descripcion.length > 0
            ? item.descripcion
            : "Sin descripción"
        }}</span
      >
    </div>
    <div class="right-side col-3 flex align-items-center justify-content-end">
      <div class="flex flex-row align-items-center justify-content-end gap-2">
        <span
          class="text-xs hidden md:block unbreakable-text"
          pTooltip="Fecha de creación: {{
            item.createdAt | date : 'dd/MM/yyyy HH:mm'
          }}"
          tooltipPosition="top"
        >
          {{ item.createdAt | date : "short" }}</span
        >
        <p-button
          (click)="
            $event.stopPropagation();
            $event.preventDefault();
            eliminar(item.id, $event)
          "
          icon="pi pi-trash"
          pTooltip="Eliminar planificación"
          styleClass="p-button-danger"
        ></p-button>
        <p-button
          (click)="
            $event.stopPropagation();
            $event.preventDefault();
            navigateToDetailview(item.id)
          "
          icon="pi pi-pencil"
          pTooltip="Editar planificación"
        ></p-button>
        <p-button
          *ngIf="expectedRole == 'ADMIN'"
          (click)="
            $event.stopPropagation();
            $event.preventDefault();
            clonarPlanificacion(item.id)
          "
          icon="pi pi-copy"
          pTooltip="Clonar planificación"
        ></p-button>
      </div>
    </div>
  </div>
</ng-template>
